{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"C:/CSAI_Front/node_modules/@babel/runtime/helpers/interopRequireDefault.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es.array.push.js\");\nvar _StringUtil = _interopRequireDefault(require(\"../../../utils/StringUtil\"));\nvar _LoadingArea = _interopRequireDefault(require(\"@/components/common/layer/LoadingArea\"));\nvar _vueMultiselect = _interopRequireDefault(require(\"vue-multiselect\"));\n// 로딩 레이어\n\nlet officesCodeArray = new Array();\nvar _default = {\n  name: 'AlarmNATartgetList',\n  emits: [\"openLayerPop\"],\n  components: {\n    LoadingArea: _LoadingArea.default,\n    Multiselect: _vueMultiselect.default\n  },\n  data() {\n    return {\n      //------------------------------------------------------------\n      // 페이지 처리 \n      //------------------------------------------------------------\n      pageNumber: 0,\n      //페이지 번호\n      recordSize: 10,\n      //한페이지당 보여질 리스트 갯수\n      prevPage: false,\n      nextPage: false,\n      //------------------------------------------------------------\n      // 페이지 블럭 처리 \n      //------------------------------------------------------------\n      blockPerPageSize: 10,\n      //블럭당 보여질 페이지 갯수\n      blockPageNumber: 0,\n      //블럭 페이지번호\n      blockPageCnt: 0,\n      //페이지 블럭 갯수\n      prevBlock: false,\n      nextBlock: false,\n      loading: false,\n      value: [\n        // {name : '방배국사', code : 'gcode02'},\n      ],\n      options: [\n        // {name : '과천국사', code : 'gcode03'},\n        // {name : '목동국사', code : 'gcode04'},\n        // {name : '태백국사', code : 'gcode05'},\n        // {name : '화곡국사', code : 'gcode06'},\n        // {name : '수내국사', code : 'gcode07'},\n        // {name : '동대문국사', code : 'gcode08'},\n        // {name : '을지로국사', code : 'gcode09'},\n        // {name : '신림국사', code : 'gcode10'},\n        // {name : '신도림국사', code : 'gcode11'},\n      ],\n      show_reservation: false,\n      reservationDate: [{\n        value: \"09:00\"\n      }, {\n        value: \"10:00\"\n      }, {\n        value: \"11:00\"\n      }, {\n        value: \"12:00\"\n      }, {\n        value: \"13:00\"\n      }, {\n        value: \"14:00\"\n      }, {\n        value: \"15:00\"\n      }, {\n        value: \"16:00\"\n      }, {\n        value: \"17:00\"\n      }],\n      reservationTtId: \"\",\n      errorTxt: \"\"\n    };\n  },\n  created() {},\n  computed: {\n    // AI 무출동 정보 조회    \n    nonMoveTgtList() {\n      return this.$store.state.trouble.nonMoveTgtList;\n    },\n    userInfo() {\n      // 로그인 사용자 정보\n      return this.$store.state.auth.userInfo;\n    },\n    ossInfo() {\n      // 로그인 사용자 정보\n      return this.$store.state.auth.ossInfo;\n    },\n    // 국사정보 조회\n    officeCodeList() {\n      return this.$store.state.trouble.officeCodeList;\n    },\n    // 국사정보 조회 - 멀티셀랙트\n    officeCodeSelect() {\n      return this.$store.state.select.officeCodeSelect;\n    }\n  },\n  methods: {\n    // 국사정보 조회\n    //--------------------------------\n    getOfficeCodeList() {\n      let param = {\n        \"userId\": this.userInfo.loginId //사용자 ID\n      };\n\n      this.$store.dispatch(\"trouble/officeCodeList\", param).then(() => {\n        for (var i = 0; i < this.officeCodeList.length; i++) {\n          var item = {};\n          item.name = this.officeCodeList[i].officesCodeDesc;\n          item.code = this.officeCodeList[i].officesCode;\n          this.options.push(item);\n        }\n        this.getNonMoveTgtList(0);\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    //--------------------------------\n    // AI 무출동 대상조회\n    //--------------------------------\n    getNonMoveTgtList(pageNo) {\n      if (pageNo < this.blockPageNumber * this.blockPerPageSize) {\n        this.getPrevBlock(pageNo);\n        return;\n      }\n      if (pageNo == (this.blockPageNumber + 1) * this.blockPerPageSize) {\n        this.getNextBlock(pageNo);\n        return;\n      }\n\n      //----------------------------------------------------------------\n      // Param Info\n      //----------------------------------------------------------------\n      let custName = document.getElementById(\"custName\").value; //고객명\n      let svcId = document.getElementById(\"svcId\").value; //접속번호\n      //★★★★★★★★★★★★★★ 추후 확인필요\n      if (svcId != null && svcId != '') {\n        svcId = '0' + svcId;\n        if (svcId.indexOf('02') == 1) {\n          svcId = '0' + svcId;\n        }\n      }\n      //let troubReceiptDt = document.getElementById(\"troubReceiptDt\").value;   //접수일시    \n      let rsvDt = document.getElementById(\"rsvDt\").value;\n      let svcMainClsCodeArray = this.productChk();\n      if (rsvDt == '') {\n        alert(\"희망일을 선택 하세요\");\n        document.getElementById(\"rsvDt\").focus();\n        return;\n      }\n      rsvDt = rsvDt.replace(/-/g, '');\n      let ttId = \"\";\n      // TTID 값이 URL에 포함될 경우\n      if (this.chkNull(this.ossInfo.TTID)) {\n        //document.getElementById(\"rsvDt\").value = \"\"\n        ttId = this.ossInfo.TTID;\n        //rsvDt = '';\n      }\n\n      let param = {\n        \"pageNo\": pageNo,\n        \"recordSize\": this.recordSize,\n        \"svcMainClsCode\": svcMainClsCodeArray,\n        \"custName\": custName,\n        \"svcId\": svcId,\n        \"ttId\": ttId,\n        //\"troubReceiptDt\" : troubReceiptDt,\n        \"rsvDt\": rsvDt,\n        \"userId\": this.userInfo.loginId,\n        //사용자 ID\n        \"officesCode\": officesCodeArray\n      };\n      this.loading = true;\n      this.$store.dispatch(\"trouble/nonMoveTgtList\", param).then(() => {\n        //----------------------------------------------------------------\n        // 페이징 처리        \n        //----------------------------------------------------------------\n        let listObj = this.nonMoveTgtList;\n        this.pageNumber = listObj.pageable.pageNumber; //페이지 번호\n        let totalPages = listObj.totalPages; //총페이지 수\n        let totalCnt = listObj.totalElements; //총 건수          \n        document.getElementById(\"totalCnt\").innerHTML = totalCnt.toLocaleString();\n        this.pagination(this.pageNumber, totalPages, totalCnt);\n        this.loading = false;\n        if (this.chkNull(this.ossInfo.TTID)) {\n          if (this.nonMoveTgtList.content.length != 0) {\n            //document.getElementById(\"troubReceiptDt\").value = this.nonMoveTgtList.content[0].troubReceiptDt.split(\" \")[0]\n            var rsvDt = this.nonMoveTgtList.content[0].rsvDt;\n            var cnvRsvDt = rsvDt.substr(0, 4) + \"-\" + rsvDt.substr(4, 2) + \"-\" + rsvDt.substr(6, 2);\n            document.getElementById(\"rsvDt\").value = cnvRsvDt;\n            this.$emit('openLayerPop', this.nonMoveTgtList.content[0]);\n            this.ossInfo.TTID = \"\";\n          }\n        }\n      }).catch(error => {\n        this.loading = false;\n        console.log(error);\n      });\n    },\n    pagination(pageNumber, totalPages, totalCnt) {\n      //--------------------------------------\n      // 페이지 네비게이션 처리\n      //--------------------------------------        \n      if (totalCnt == 0) {\n        this.prevPage = false;\n        this.nextPage = false;\n      } else {\n        if (pageNumber == 0) {\n          this.prevPage = false;\n          if (totalPages == 1) {\n            this.nextPage = false;\n          } else {\n            this.nextPage = true;\n          }\n        } else {\n          if (pageNumber == totalPages - 1) {\n            this.prevPage = true;\n            this.nextPage = false;\n          } else {\n            this.prevPage = true;\n            this.nextPage = true;\n          }\n        }\n      }\n\n      //--------------------------------------\n      // 페이지의 페이지 네비게이션 처리\n      //--------------------------------------        \n      let blockPageCnt = 0;\n      let blockPerPageSize = this.blockPerPageSize;\n      if (totalPages % blockPerPageSize == 0) {\n        blockPageCnt = totalPages / blockPerPageSize;\n      } else {\n        blockPageCnt = Math.floor(totalPages / blockPerPageSize) + 1;\n      }\n      this.blockPageCnt = blockPageCnt;\n      if (this.blockPageNumber == 0) {\n        this.prevBlock = false;\n        if (this.blockPageCnt == 1) {\n          this.nextBlock = false;\n        } else {\n          if (this.blockPageNumber + 1 <= this.blockPageCnt) {\n            this.nextBlock = true;\n          }\n        }\n      } else {\n        this.prevBlock = true;\n        if (this.blockPageNumber + 1 == this.blockPageCnt) {\n          this.nextBlock = false;\n        } else {\n          this.nextBlock = true;\n        }\n      }\n    },\n    getPrevBlock(pageNo) {\n      this.blockPageNumber = this.blockPageNumber - 1;\n      let pageNumber = this.blockPageNumber * this.blockPerPageSize;\n      if (pageNo != null) {\n        pageNumber = pageNo;\n      }\n      this.getNonMoveTgtList(pageNumber);\n    },\n    getNextBlock(pageNo) {\n      this.blockPageNumber = this.blockPageNumber + 1;\n      let pageNumber = this.blockPageNumber * this.blockPerPageSize;\n      if (pageNo != null) {\n        pageNumber = pageNo;\n      }\n      this.getNonMoveTgtList(pageNumber);\n    },\n    productChk() {\n      let productArray = new Array();\n      let arrProduct = document.getElementsByName(\"product\");\n      for (var i = 0; i < arrProduct.length; i++) {\n        if (arrProduct[i].checked) {\n          productArray.push(arrProduct[i].value);\n        }\n      }\n      return productArray;\n    },\n    //접수일자 셋팅\n    setReceiptDt() {\n      var now = new Date();\n      var year = now.getFullYear();\n      var month = now.getMonth() + 1;\n      if (month <= 9) {\n        month = \"0\" + month;\n      }\n      var day = now.getDate();\n      if (day <= 9) {\n        day = \"0\" + day;\n      }\n      var today = year + \"-\" + month + \"-\" + day;\n      //document.getElementById(\"troubReceiptDt\").value = today;            \n      document.getElementById(\"rsvDt\").value = today;\n    },\n    StringUtil() {\n      var obj = _StringUtil.default;\n      return obj;\n    },\n    selectedOfficeCode(item) {\n      officesCodeArray = new Array();\n      for (var i = 0; i < item.length; i++) {\n        officesCodeArray.push(item[i].code);\n      }\n      //----------- TEST -----------------        \n      if (this.$store.state.select.officeCodeSelect != []) {\n        //this.$store.commit(\"select/OFFICE_CODE_SELECT\",officesCodeArray);  //type 1 :: vuex에 값 담기\n        localStorage.setItem(\"officeCodeSelect\", officesCodeArray); //type 2 :: 설정한 key에 값 담기          \n      }\n      //----------------------------------                \n    },\n\n    chkNull(val) {\n      if (val != null && val != undefined && val != \"\") {\n        return true;\n      } else {\n        return false;\n      }\n    },\n    openAlarmPreviewPopup(item) {\n      let options = \"top=10, width=1200, height=950, status=no, menubar=no, toolbar=no, resizable=no\";\n      window.open(\"/popup/AlarmPreviewPopup?ttId=\" + item.ttId, \"AlarmPreviewPopup\", options);\n    },\n    rsvStr(str) {\n      return str.split(\" \")[0] + \" \" + str.split(\" \")[1].substr(0, 5);\n    },\n    showReservation(item) {\n      this.reservationTtId = item.ttId;\n      this.show_reservation = true;\n      if (item.reservationTime != null) {\n        document.getElementById(\"reservation_date\").value = item.reservationTime.split(\" \")[0];\n        document.getElementById(\"reservation_time\").value = item.reservationTime.split(\" \")[1].substr(0, 5);\n      }\n    },\n    closeReservation() {\n      this.errorTxt = \"\";\n      this.show_reservation = false;\n    },\n    setConsultReservation() {\n      let reservation_date = document.getElementById(\"reservation_date\").value;\n      if (reservation_date == \"\") {\n        this.errorTxt = \"예약일을 입력해주세요.\";\n        return;\n      }\n      this.errorTxt = \"\";\n      let reservation_time = document.getElementById(\"reservation_time\").value;\n      let rsv_time = reservation_date + \" \" + reservation_time;\n      if (confirm(rsv_time + \"로 예약 하시겠습니까?\")) {\n        let payload = {\n          tt_id: this.reservationTtId,\n          status: 'reservation',\n          rsv_time: reservation_date + \"T\" + reservation_time + \":00\"\n        };\n        this.$store.dispatch(\"consult/consultReservation\", payload).then(() => {\n          alert(\"상담이 예약되었습니다.\");\n          this.show_reservation = false;\n          this.getNonMoveTgtList(0);\n        }).catch(error => {\n          console.log(error);\n          this.errorTxt = \"시스템 에러입니다.\";\n        });\n      }\n    }\n  },\n  mounted() {\n    this.setReceiptDt(); //접수일자 셋팅\n    this.getOfficeCodeList(); //수용국사 조회\n  }\n};\nexports.default = _default;","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}