{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n//import guide from '@/store/modules/guide';\nexport default {\n  name: 'ConsultGuidelines',\n  emits: [\"showImg\"],\n  data() {\n    return {\n      on_main_num: 0,\n      on_sub_num: 0,\n      next_show: true,\n      checkNone: false,\n      done: 0,\n      go_reason: \"\",\n      show_go_reason: false,\n      errorTxt: \"\",\n      errorImgList: []\n    };\n  },\n  created() {},\n  computed: {\n    eglList() {\n      return this.$store.state.guide.eglList;\n    },\n    roomInfo() {\n      return this.$store.state.alarm.roomInfo;\n    },\n    consultDone() {\n      return this.$store.state.consult.consultDone;\n    },\n    consultTarget() {\n      // 로그인 사용자 정보\n      return this.$store.state.consult.consultTarget;\n    }\n  },\n  methods: {\n    getEgl() {\n      // 초기화.\n      let target = document.querySelectorAll(\".guideNoneImg\");\n      for (let j in target) {\n        if (!isNaN(j)) target[j].classList.remove(\"guideNoneImg\");\n      }\n      this.on_main_num = 0;\n      this.on_sub_num = 0;\n      // TTID로 조회\n      let item = this.consultTarget.currTtID; //localStorage.getItem('ttId'); //\"2023031600000013\";\n      this.$store.dispatch(\"guide/egl\", item).then(() => {\n        if (this.eglList.guide_lines.length > 0) {\n          console.log(this.eglList);\n          this.checkNone = false;\n          this.$forceUpdate();\n          // 신규로 추가된 이미지 에러 안나는 부분 처리 추가\n          if (this.errorImgList.length != 0) {\n            for (let i in this.errorImgList) {\n              let target = document.querySelectorAll(\".img_group_\" + this.errorImgList[i] + \" > div\");\n              for (let j in target) {\n                if (!isNaN(j)) target[j].classList.add(\"guideNoneImg\");\n              }\n            }\n          }\n        } else {\n          this.checkNone = true;\n        }\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    nextEgl() {\n      // eslint-disable-next-line\n      //debugger;\n      if (this.on_sub_num + 1 < this.eglList.guide_lines[this.on_main_num].guides.length) {\n        this.on_sub_num++;\n      } else {\n        if (this.eglList.guide_lines[this.on_main_num + 1] != undefined) {\n          this.on_sub_num = 0;\n          this.on_main_num++;\n        } else {\n          //this.next_show = false;\n          // 초기화 시키는 로직\n          this.on_sub_num = 0;\n          this.on_main_num = 0;\n        }\n      }\n    },\n    changeMainNum(idx) {\n      this.on_sub_num = 0;\n      this.on_main_num = idx;\n    },\n    changeSubNum(idx) {\n      this.on_sub_num = idx;\n    },\n    changeScroll(idx) {\n      if (idx > 5) {\n        document.getElementById(\"on_main_\" + this.on_main_num).scrollTop = idx > 5 ? (idx - 5) * 40 : 0;\n      } else {\n        document.getElementById(\"on_main_\" + this.on_main_num).scrollTop = 0;\n      }\n    },\n    showImg(value, type) {\n      console.log(value);\n      this.$emit('showImg', value, type);\n    },\n    showGoReason() {\n      this.show_go_reason = true;\n    },\n    closeGoReason() {\n      this.errorTxt = \"\";\n      this.go_reason = \"\";\n      document.getElementById(\"go_reason\").value = \"\";\n      this.show_go_reason = false;\n    },\n    //https://dev.ap.csai.kt.co.kr:8080/api/consult/done\n    btnConsultDone(value) {\n      // 상담 진행 여부 판단 필요.\n      // 출동 사유 글자수 확인\n      this.go_reason = document.getElementById(\"go_reason\").value;\n      if (value == \"Y\" && this.go_reason.length > 1000) {\n        this.errorTxt = \"1000글자 이하로 작성 가능합니다. (\" + this.go_reason.length + \"/1000)\";\n        return;\n      }\n      let doneTypeName = value == 'Y' ? \"출동 요청\" : \"무출동 처리 완료\";\n      if (confirm(doneTypeName + \" 하시겠습니까? 완료시 상담이 종료됩니다.\")) {\n        // AI 조치 가이드 코드 생성\n        let fileCode = \"\";\n        if (this.eglList.guide_lines[this.on_main_num].guides[this.on_sub_num].file != null) {\n          fileCode = this.eglList.guide_lines[this.on_main_num].guides[this.on_sub_num].file.split(\"_\");\n          fileCode = fileCode[0] + '_' + fileCode[fileCode.length - 1];\n        }\n        let item = {\n          consult_id: this.consultTarget.currConsultId,\n          last_guide_code: fileCode,\n          scn: this.eglList.guide_lines[this.on_main_num].guides[this.on_sub_num].scn,\n          go_reason: this.go_reason,\n          go_yn: value\n        };\n        // 출동 또는 무출동 처리 완료\n        this.$store.dispatch(\"consult/consultDone\", item).then(() => {\n          if (this.consultDone.errorCode == null) {\n            // 상담 초기화\n            this.consultTarget.consultArray = [];\n            alert(doneTypeName + \", 상담이 종료되었습니다.\");\n            this.$router.push({\n              path: '/alarm'\n            });\n          } else {\n            alert(this.consultDone.message);\n          }\n        }).catch(error => {\n          console.log(error);\n        });\n      }\n    },\n    hideErrorImg(idx) {\n      if (this.errorImgList.indexOf(idx) == -1) {\n        this.errorImgList.push(idx);\n        console.log(this.errorImgList);\n      }\n      // 동일한 이미지 포함 전체 처리\n      let target = document.querySelectorAll(\".img_group_\" + idx + \" > div\");\n      for (let j in target) {\n        if (!isNaN(j)) target[j].classList.add(\"guideNoneImg\");\n      }\n    },\n    openConsultGuideTextPopup() {\n      let rigthPosition = document.body.offsetWidth - 730;\n      rigthPosition += window.screenLeft;\n      let options = \"top=10, left=\" + rigthPosition + \", width=900, height=900, status=no, menubar=no, toolbar=no, resizable=no\";\n      window.open(\"/popup/ConsultGuideTextPopup?ttId=\" + this.consultTarget.currTtID + \"&main=\" + this.on_main_num + \"&sub=\" + this.on_sub_num, \"ConsultHdmsResultInfoPopup\", options);\n    }\n  },\n  updated() {\n    if (document.getElementById(\"on_main_\" + this.on_main_num) != null) {\n      this.changeScroll(this.on_sub_num);\n    }\n    // 다음 조치. class 처리\n  }\n};","map":{"version":3,"mappings":"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","names":["name","emits","data","on_main_num","on_sub_num","next_show","checkNone","done","go_reason","show_go_reason","errorTxt","errorImgList","created","computed","eglList","$store","state","guide","roomInfo","alarm","consultDone","consult","consultTarget","methods","getEgl","target","document","querySelectorAll","j","isNaN","classList","remove","item","currTtID","dispatch","then","guide_lines","length","console","log","$forceUpdate","i","add","catch","error","nextEgl","guides","undefined","changeMainNum","idx","changeSubNum","changeScroll","getElementById","scrollTop","showImg","value","type","$emit","showGoReason","closeGoReason","btnConsultDone","doneTypeName","confirm","fileCode","file","split","consult_id","currConsultId","last_guide_code","scn","go_yn","errorCode","consultArray","alert","$router","push","path","message","hideErrorImg","indexOf","openConsultGuideTextPopup","rigthPosition","body","offsetWidth","window","screenLeft","options","open","updated"],"sourceRoot":"","sources":["C:\\CSAI_Front\\src\\views\\pages\\consult\\ConsultGuidelines.vue"],"sourcesContent":["<template>\r\n  <!-- group_item -->\r\n  <div class=\"group_item\">\r\n    <h1>AI 조치 가이드</h1>\r\n    <!-- egl_box -->\r\n    <div class=\"egl_box\">\r\n      <div class=\"egl_guide_no_data\" v-if=\"checkNone\">\r\n        <p>AI 조치 가이드 데이터가 없습니다.</p>\r\n      </div>\r\n      <div class=\"egl_guide\" v-if=\"eglList.length != 0\">\r\n        <ul :class=\"'menu_line' + ' st0' + eglList.guide_lines.length\">\r\n          <li v-for=\"(item, idx) in eglList.guide_lines\" :key=\"idx\" :class=\"'egl_menu_' + item.terml_type + ' ' + (on_main_num == idx ? 'on' : '')\" @click=\"changeMainNum(idx)\">\r\n            <span>{{item.terml_type}}</span>\r\n          </li>\r\n        </ul>\r\n        <div v-for=\"(item, idx) in eglList.guide_lines\" :key=\"idx\" v-show=\"on_main_num == idx\" class=\"oy_s\" :id=\"'on_main_' + idx\">\r\n          <ul :class=\"'guide_line' + ' st0' + item.guides.length + ' ' + (item.guides.length > 6 ? 'sc' : '')\">\r\n            <li v-for=\"(item1, idx1) in item.guides\" :key=\"idx1\" :class=\"(on_sub_num == idx1 ? 'on' : '')\"  @click=\"changeSubNum(idx1)\">\r\n              <dl>\r\n                <dt>step0{{idx1 + 1}}</dt>\r\n                <dd :title=\"item1.title\">{{item1.title}}</dd>\r\n              </dl>\r\n            </li>\r\n          </ul>\r\n          <div v-for=\"(item1, idx1) in item.guides\" :key=\"idx1\" :class=\"'guide_box oy_s' + (on_sub_num == idx1 ? ' on' : '') + ' idx_' + idx1 + ' img_group_' + item1.file\" v-show=\"on_sub_num == idx1\"  :style=\"'margin-top:' + (idx1 > 5 ? (idx1 - 5) * 40 : 0) + 'px'\">\r\n            <div>\r\n              <div>\r\n                <div>\r\n                  <p class=\"guide_img\"><img :src=\"'/nas/' + item1.file + '.png'\" :alt=\"item1.file\" @error=\"hideErrorImg(item1.file)\"></p>\r\n                </div>\r\n                <ul class=\"guide_detail\">\r\n                  <li class=\"guide_img_view\" @click=\"showImg(item1.file, 'IM')\" v-show=\"this.consultTarget.popupYn == 'N'\">상세이미지</li>\r\n                  <li class=\"guide_text_view\" @click=\"openConsultGuideTextPopup()\">상세가이드</li>\r\n                </ul>\r\n                <p>\r\n                  {{item1.description}}\r\n                </p>\r\n              </div>\r\n              <div class=\"noneImgText\">다음 조치로 넘어가주세요.</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"ctl_line\" v-if=\"!checkNone\">\r\n          <button @click=\"nextEgl()\" v-show=\"next_show\">다음조치</button>\r\n          <ul v-show=\"this.consultTarget.popupYn == 'N'\">\r\n            <li><button @click=\"btnConsultDone('N')\">무출동 처리 완료</button></li>\r\n            <li><button @click=\"showGoReason\">출동 요청</button></li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!--// egl_box -->\r\n  </div>\r\n  <!--// group_item -->\r\n  <div class=\"layer_popup\" v-show=\"show_go_reason\">\r\n    <div class=\"go_reason_box\">\r\n      <h1>출동 처리 사유 입력</h1>\r\n      <div class=\"layer_box\">\r\n        <textarea class=\"ta_box oy_s\" id=\"go_reason\" v-text=\"go_reason\"></textarea>\r\n        <button @click=\"btnConsultDone('Y')\">출동 요청 완료</button>\r\n        <p class=\"error_txt\">{{errorTxt}}</p>\r\n      </div>\r\n      <p class=\"layer_close\" @click=\"closeGoReason\"></p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script>\r\n  //import guide from '@/store/modules/guide';\r\n  export default {\r\n    name: 'ConsultGuidelines',\r\n    emits : [\"showImg\"],\r\n    data() {\r\n      return {\r\n        on_main_num : 0,\r\n        on_sub_num : 0,\r\n        next_show : true,\r\n        checkNone : false,\r\n        done : 0,\r\n        go_reason : \"\",\r\n        show_go_reason : false,\r\n        errorTxt : \"\",\r\n        errorImgList : [],\r\n      }\r\n    },\r\n    created() {\r\n      \r\n    },\r\n    computed: {\r\n      eglList(){\r\n        return this.$store.state.guide.eglList;\r\n      },\r\n      roomInfo() {\r\n        return this.$store.state.alarm.roomInfo;\r\n      },\r\n      consultDone() {\r\n        return this.$store.state.consult.consultDone;\r\n      },\r\n      consultTarget() {\r\n      // 로그인 사용자 정보\r\n        return this.$store.state.consult.consultTarget;\r\n      },\r\n    },\r\n    methods: {\r\n      getEgl(){\r\n        // 초기화.\r\n        let target = document.querySelectorAll(\".guideNoneImg\");\r\n        for(let j in target){\r\n          if(!isNaN(j))\r\n          target[j].classList.remove(\"guideNoneImg\");\r\n        }\r\n        this.on_main_num = 0;\r\n        this.on_sub_num = 0;\r\n        // TTID로 조회\r\n        let item = this.consultTarget.currTtID; //localStorage.getItem('ttId'); //\"2023031600000013\";\r\n        this.$store.dispatch(\"guide/egl\", item).then(() => {\r\n          if(this.eglList.guide_lines.length > 0){ \r\n            console.log(this.eglList);\r\n            this.checkNone = false;\r\n            this.$forceUpdate();\r\n            // 신규로 추가된 이미지 에러 안나는 부분 처리 추가\r\n            if(this.errorImgList.length != 0){\r\n              for(let i in this.errorImgList){\r\n                let target = document.querySelectorAll(\".img_group_\" + this.errorImgList[i] + \" > div\");\r\n                for(let j in target){\r\n                  if(!isNaN(j))\r\n                  target[j].classList.add(\"guideNoneImg\");\r\n                }\r\n              }\r\n\r\n            }\r\n          }else{\r\n            this.checkNone = true;\r\n          }\r\n          \r\n        })\r\n        .catch(error => {\r\n          console.log(error);\r\n        });\r\n      },\r\n      nextEgl(){\r\n        // eslint-disable-next-line\r\n        //debugger;\r\n        if(this.on_sub_num + 1 < this.eglList.guide_lines[this.on_main_num].guides.length){\r\n          this.on_sub_num++;\r\n        }else{\r\n          if(this.eglList.guide_lines[this.on_main_num + 1] != undefined){\r\n            this.on_sub_num = 0;\r\n            this.on_main_num++;\r\n          } else {\r\n            //this.next_show = false;\r\n            // 초기화 시키는 로직\r\n            this.on_sub_num = 0;\r\n            this.on_main_num = 0;\r\n          }\r\n        }\r\n      },\r\n      changeMainNum(idx){\r\n        this.on_sub_num = 0;\r\n        this.on_main_num = idx;\r\n      },\r\n      changeSubNum(idx){\r\n        this.on_sub_num = idx;\r\n      },\r\n      changeScroll(idx){\r\n        if(idx > 5){\r\n          document.getElementById(\"on_main_\" + this.on_main_num).scrollTop = idx > 5 ? (idx - 5) * 40 : 0\r\n        }else{\r\n          document.getElementById(\"on_main_\" + this.on_main_num).scrollTop = 0;\r\n        }\r\n      },\r\n      showImg(value, type){\r\n        console.log(value);\r\n        this.$emit('showImg', value, type);\r\n      },\r\n      showGoReason(){\r\n        this.show_go_reason = true;\r\n      },\r\n      closeGoReason(){\r\n        this.errorTxt = \"\";\r\n        this.go_reason = \"\";\r\n        document.getElementById(\"go_reason\").value = \"\";\r\n        this.show_go_reason = false;\r\n      },\r\n      //https://dev.ap.csai.kt.co.kr:8080/api/consult/done\r\n      btnConsultDone(value){\r\n        // 상담 진행 여부 판단 필요.\r\n        // 출동 사유 글자수 확인\r\n        this.go_reason = document.getElementById(\"go_reason\").value;\r\n        if(value == \"Y\" && this.go_reason.length > 1000){\r\n          this.errorTxt = \"1000글자 이하로 작성 가능합니다. (\"+ this.go_reason.length +\"/1000)\"\r\n          return;\r\n        }\r\n        let doneTypeName = value == 'Y' ? \"출동 요청\" : \"무출동 처리 완료\";\r\n        if(confirm(doneTypeName + \" 하시겠습니까? 완료시 상담이 종료됩니다.\")){\r\n          // AI 조치 가이드 코드 생성\r\n          let fileCode = \"\";\r\n          if(this.eglList.guide_lines[this.on_main_num].guides[this.on_sub_num].file != null){\r\n            fileCode = this.eglList.guide_lines[this.on_main_num].guides[this.on_sub_num].file.split(\"_\");\r\n            fileCode = fileCode[0] + '_' + fileCode[fileCode.length - 1];\r\n          }\r\n          let item = {\r\n            consult_id : this.consultTarget.currConsultId,\r\n            last_guide_code : fileCode,\r\n            scn : this.eglList.guide_lines[this.on_main_num].guides[this.on_sub_num].scn,\r\n            go_reason : this.go_reason,\r\n            go_yn : value\r\n          };\r\n          // 출동 또는 무출동 처리 완료\r\n          this.$store.dispatch(\"consult/consultDone\", item).then(() => {\r\n            if(this.consultDone.errorCode == null){ \r\n              // 상담 초기화\r\n              this.consultTarget.consultArray = [];\r\n              alert(doneTypeName + \", 상담이 종료되었습니다.\");\r\n              this.$router.push({path:'/alarm'});\r\n            }else{\r\n              alert(this.consultDone.message);\r\n            }\r\n          })\r\n          .catch(error => {\r\n            console.log(error);\r\n          });\r\n        }\r\n      },\r\n      hideErrorImg(idx){\r\n        if(this.errorImgList.indexOf(idx) == -1 ){\r\n          this.errorImgList.push(idx);\r\n          console.log(this.errorImgList);\r\n        }\r\n        // 동일한 이미지 포함 전체 처리\r\n        let target = document.querySelectorAll(\".img_group_\" + idx + \" > div\");\r\n        for(let j in target){\r\n          if(!isNaN(j))\r\n          target[j].classList.add(\"guideNoneImg\");\r\n        }\r\n      },\r\n      openConsultGuideTextPopup(){\r\n        let rigthPosition = (document.body.offsetWidth) - 730;\r\n        rigthPosition += window.screenLeft;\r\n\r\n        let options = \"top=10, left=\" + rigthPosition +\", width=900, height=900, status=no, menubar=no, toolbar=no, resizable=no\";\r\n        window.open(\"/popup/ConsultGuideTextPopup?ttId=\" + this.consultTarget.currTtID + \"&main=\" + this.on_main_num + \"&sub=\" + this.on_sub_num, \"ConsultHdmsResultInfoPopup\", options);\r\n      },\r\n    },\r\n\r\n    updated(){\r\n      if(document.getElementById(\"on_main_\" + this.on_main_num) != null){\r\n        this.changeScroll(this.on_sub_num);\r\n      }\r\n      // 다음 조치. class 처리\r\n    }\r\n  }\r\n</script>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}