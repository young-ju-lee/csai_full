{"ast":null,"code":"import StringUtil from '../../../utils/StringUtil';\nimport LoadingArea from '@/components/common/layer/LoadingArea'; // 로딩 레이어\n\nexport default {\n  name: 'AlarmSendHistList',\n  emits: [\"openLayerPop\"],\n  components: {\n    LoadingArea\n  },\n  data() {\n    return {\n      //------------------------------------------------------------\n      // 페이지 처리 \n      //------------------------------------------------------------\n      pageNumber: 0,\n      //페이지 번호\n      recordSize: 10,\n      //한페이지당 보여질 리스트 갯수\n      prevPage: false,\n      nextPage: false,\n      //------------------------------------------------------------\n      // 페이지 블럭 처리 \n      //------------------------------------------------------------\n      blockPerPageSize: 10,\n      //블럭당 보여질 페이지 갯수\n      blockPageNumber: 0,\n      //블럭 페이지번호\n      blockPageCnt: 0,\n      //페이지 블럭 갯수\n      prevBlock: false,\n      nextBlock: false,\n      loading: false\n    };\n  },\n  created() {},\n  computed: {\n    // 알림톡 발송이력 조회\n    alarmTalkSndHistList() {\n      return this.$store.state.trouble.alarmTalkSndHistList;\n    },\n    userInfo() {\n      // 로그인 사용자 정보\n      return this.$store.state.auth.userInfo;\n    }\n  },\n  methods: {\n    getAlarmTalkSndHistList(pageNo) {\n      if (pageNo < this.blockPageNumber * this.blockPerPageSize) {\n        this.getPrevBlock(pageNo);\n        return;\n      }\n      if (pageNo == (this.blockPageNumber + 1) * this.blockPerPageSize) {\n        this.getNextBlock(pageNo);\n        return;\n      }\n\n      //----------------------------------------------------------------\n      // Param Info\n      //----------------------------------------------------------------                \n      let custName = document.getElementById(\"custName\").value; //고객명\n      let custTelNo = document.getElementById(\"custTelNo\").value; //고객전화번호\n      let sndFromDt = document.getElementById(\"sndFromDt\").value; //발송일시 From           \n      let sndToDt = document.getElementById(\"sndToDt\").value; //발송일시 To                 \n      if (custTelNo.indexOf(\"0\") == 0) {\n        custTelNo = \"82\" + custTelNo.substr(1, custTelNo.length);\n      }\n\n      // 유효성 체크\n      if (!this.isValidation()) {\n        return;\n      }\n      let param = {\n        \"pageNo\": pageNo,\n        \"recordSize\": this.recordSize,\n        \"sndCmpNo\": this.userInfo.loginId,\n        //발송자 ID\n        \"custName\": custName,\n        \"custTelNo\": custTelNo,\n        \"sndFromDt\": sndFromDt,\n        \"sndToDt\": sndToDt\n      };\n      this.loading = true;\n      this.$store.dispatch(\"trouble/alarmTalkSndHistList\", param).then(() => {\n        //----------------------------------------------------------------\n        // 페이징 처리        \n        //----------------------------------------------------------------\n        let listObj = this.alarmTalkSndHistList;\n        this.pageNumber = listObj.pageable.pageNumber; //페이지 번호\n        let totalPages = listObj.totalPages; //총페이지 수\n        let totalCnt = listObj.totalElements; //총 건수\n        document.getElementById(\"totalCnt\").innerHTML = totalCnt.toLocaleString();\n        this.pagination(this.pageNumber, totalPages, totalCnt);\n        this.loading = false;\n      }).catch(error => {\n        this.loading = false;\n        console.log(error);\n      });\n    },\n    pagination(pageNumber, totalPages, totalCnt) {\n      //--------------------------------------\n      // 페이지 네비게이션 처리\n      //--------------------------------------        \n      if (totalCnt == 0) {\n        this.prevPage = false;\n        this.nextPage = false;\n      } else {\n        if (pageNumber == 0) {\n          this.prevPage = false;\n          if (totalPages == 1) {\n            this.nextPage = false;\n          } else {\n            this.nextPage = true;\n          }\n        } else {\n          if (pageNumber == totalPages - 1) {\n            this.prevPage = true;\n            this.nextPage = false;\n          } else {\n            this.prevPage = true;\n            this.nextPage = true;\n          }\n        }\n      }\n\n      //--------------------------------------\n      // 페이지의 페이지 네비게이션 처리\n      //--------------------------------------        \n      let blockPageCnt = 0;\n      let blockPerPageSize = this.blockPerPageSize;\n      if (totalPages % blockPerPageSize == 0) {\n        blockPageCnt = totalPages / blockPerPageSize;\n      } else {\n        blockPageCnt = Math.floor(totalPages / blockPerPageSize) + 1;\n      }\n      this.blockPageCnt = blockPageCnt;\n      if (this.blockPageNumber == 0) {\n        this.prevBlock = false;\n        if (this.blockPageCnt == 1) {\n          this.nextBlock = false;\n        } else {\n          if (this.blockPageNumber + 1 <= this.blockPageCnt) {\n            this.nextBlock = true;\n          }\n        }\n      } else {\n        this.prevBlock = true;\n        if (this.blockPageNumber + 1 == this.blockPageCnt) {\n          this.nextBlock = false;\n        } else {\n          this.nextBlock = true;\n        }\n      }\n    },\n    getPrevBlock(pageNo) {\n      this.blockPageNumber = this.blockPageNumber - 1;\n      let pageNumber = this.blockPageNumber * this.blockPerPageSize;\n      if (pageNo != null) {\n        pageNumber = pageNo;\n      }\n      this.getAlarmTalkSndHistList(pageNumber);\n    },\n    getNextBlock(pageNo) {\n      this.blockPageNumber = this.blockPageNumber + 1;\n      let pageNumber = this.blockPageNumber * this.blockPerPageSize;\n      if (pageNo != null) {\n        pageNumber = pageNo;\n      }\n      this.getAlarmTalkSndHistList(pageNumber);\n    },\n    //발송일자 셋팅\n    setSndDt() {\n      var now = new Date();\n      var year = now.getFullYear();\n      var month = now.getMonth() + 1;\n      var prevMonth = now.getMonth();\n      if (month <= 9) {\n        month = \"0\" + month;\n      }\n      if (prevMonth <= 9) {\n        prevMonth = \"0\" + prevMonth;\n      }\n      var day = now.getDate();\n      if (day <= 9) {\n        day = \"0\" + day;\n      }\n      var today = year + \"-\" + month + \"-\" + day;\n      var prevMonthLastDay = new Date(year, prevMonth, \"0\").getDate();\n      if (day > prevMonthLastDay) {\n        //한달전 날짜가 해당월의 마지막 일자보다 큰경우\n        day = prevMonthLastDay;\n      }\n      var fromDay = year + \"-\" + prevMonth + \"-\" + day;\n      document.getElementById(\"sndFromDt\").value = fromDay;\n      document.getElementById(\"sndToDt\").value = today;\n    },\n    // 발송기간 유효성 체크      \n    isValidation() {\n      let sndFromDt = document.getElementById(\"sndFromDt\").value; //발송일시 From           \n      let sndToDt = document.getElementById(\"sndToDt\").value; //발송일시 To   \n      if (sndFromDt == '') {\n        alert(\"발송기간을 선택 하세요\");\n        document.getElementById(\"sndFromDt\").focus();\n        return false;\n      }\n      if (sndToDt == '') {\n        alert(\"발송기간을 선택 하세요\");\n        document.getElementById(\"sndToDt\").focus();\n        return false;\n      }\n      if (new Date(sndToDt).getTime() - new Date(sndFromDt).getTime() < 0) {\n        alert(\"이전날짜가 더 클 수 없습니다.\");\n        return false;\n      }\n      return true;\n    },\n    StringUtil() {\n      var obj = StringUtil;\n      return obj;\n    }\n  },\n  mounted() {\n    this.setSndDt();\n    this.getAlarmTalkSndHistList(0);\n  }\n};","map":{"version":3,"mappings":"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","names":["StringUtil","LoadingArea","name","emits","components","data","pageNumber","recordSize","prevPage","nextPage","blockPerPageSize","blockPageNumber","blockPageCnt","prevBlock","nextBlock","loading","created","computed","alarmTalkSndHistList","$store","state","trouble","userInfo","auth","methods","getAlarmTalkSndHistList","pageNo","getPrevBlock","getNextBlock","custName","document","getElementById","value","custTelNo","sndFromDt","sndToDt","indexOf","substr","length","isValidation","param","loginId","dispatch","then","listObj","pageable","totalPages","totalCnt","totalElements","innerHTML","toLocaleString","pagination","catch","error","console","log","Math","floor","setSndDt","now","Date","year","getFullYear","month","getMonth","prevMonth","day","getDate","today","prevMonthLastDay","fromDay","alert","focus","getTime","obj","mounted"],"sourceRoot":"","sources":["C:\\CSAI_Front\\src\\views\\pages\\alarm\\AlarmSendHistList.vue"],"sourcesContent":["<template>\r\n<div class=\"search_box\">\r\n  <ul class=\"search_st01\">\r\n    <li>\r\n      <label for=\"\">고객명</label>\r\n      <input type=\"text\" id=\"custName\" @keyup.enter=\"getAlarmTalkSndHistList(0)\">\r\n    </li>  \r\n    <li>\r\n      <label for=\"\">전화번호</label>\r\n      <input type=\"text\" id=\"custTelNo\" @keyup.enter=\"getAlarmTalkSndHistList(0)\">\r\n    </li>\r\n    <li>\r\n      <label for=\"\">발송일</label>\r\n      <input type=\"date\" id=\"sndFromDt\"> ~ <input type=\"date\" id=\"sndToDt\">\r\n    </li>\r\n    <li>\r\n      <button @click=\"getAlarmTalkSndHistList(0)\">조회</button>\r\n    </li>\r\n    \r\n  </ul>\r\n</div>\r\n<div class=\"list_box\" style=\"position:relative;\">\r\n  <p>전체건수 : <span id=\"totalCnt\">0</span>건</p>    \r\n  <table>\r\n      <colgroup>\r\n      <col style=\"width:12%\">\r\n      <col style=\"width:12%\">\r\n      <col style=\"width:15%\">\r\n      <col style=\"width:15%\">\r\n      <col style=\"width:calc(46% - 180px)\">\r\n      <col style=\"width:180px\">\r\n    </colgroup>\r\n    <thead>\r\n      <tr>        \r\n        <th>고객명</th>\r\n        <th>전화번호</th>\r\n        <th>상품</th>\r\n        <th>접수일자</th>\r\n        <th>신고내용</th>      \r\n        <th></th>            \r\n      </tr>\r\n    </thead>\r\n    <tbody>      \r\n      <!-- no-data-area -->\r\n      <tr v-if=\"alarmTalkSndHistList.totalElements == 0\">\r\n        <td class=\"no_data\" colspan=\"6\">조회된 데이터가 없습니다.</td>\r\n      </tr>\r\n\r\n      <tr v-else v-for=\"(item, idx) in alarmTalkSndHistList.content\" :key=\"idx\">      \r\n        <td>{{StringUtil().cusNmFormatter(item.customer.custNm)}}</td>                  \r\n        <td>{{StringUtil().phoneFormatter(item.customer.custTelNo)}}</td>                  \r\n        <td>{{item.svcMainClsCodeDesc}}</td>\r\n        <td>{{item.troubReceiptDt}}</td>\r\n        <td :title=\"item.reporterOpinion\">{{item.reporterOpinion}}</td>\r\n        <td><div @click=\"this.$emit('openLayerPop', this.alarmTalkSndHistList.content[idx])\"><span></span>알림톡 발송</div></td>\r\n      </tr>\r\n    </tbody>\r\n  </table>  \r\n  <ul class=\"paging\">\r\n    <li class=\"left_page\" v-show=\"prevBlock\" @click=\"getPrevBlock()\"></li>\r\n    <li class=\"left_num\" v-show=\"prevPage\" @click=\"getAlarmTalkSndHistList(this.pageNumber-1)\"></li>    \r\n    <li :class=\"{'on': idx === this.pageNumber}\"                 \r\n      v-show=\"( idx >= (this.blockPageNumber) * this.blockPerPageSize && idx < (this.blockPageNumber+1) * this.blockPerPageSize )\" \r\n      v-for=\"(item, idx) in alarmTalkSndHistList.totalPages\" :key=\"idx\" @click=\"getAlarmTalkSndHistList(idx)\">{{idx+1}}</li>                            \r\n    <li class=\"right_num\" v-show=\"nextPage\" @click=\"getAlarmTalkSndHistList(this.pageNumber+1)\"></li>\r\n    <li class=\"right_page\" v-show=\"nextBlock\" @click=\"getNextBlock()\"></li>\r\n  </ul>\r\n  <loading-area v-show=\"loading\"/>\r\n</div>\r\n</template>\r\n\r\n<script>\r\n  import StringUtil from '../../../utils/StringUtil';\r\n  import LoadingArea from '@/components/common/layer/LoadingArea'; // 로딩 레이어\r\n\r\n  export default {\r\n    name: 'AlarmSendHistList',\r\n    emits : [\"openLayerPop\"],\r\n    components: {\r\n      LoadingArea\r\n    },\r\n    data() {\r\n      return {\r\n        //------------------------------------------------------------\r\n        // 페이지 처리 \r\n        //------------------------------------------------------------\r\n        pageNumber : 0,           //페이지 번호\r\n        recordSize : 10,          //한페이지당 보여질 리스트 갯수\r\n        prevPage : false,\r\n        nextPage : false,\r\n        //------------------------------------------------------------\r\n        // 페이지 블럭 처리 \r\n        //------------------------------------------------------------\r\n        blockPerPageSize : 10,    //블럭당 보여질 페이지 갯수\r\n        blockPageNumber : 0,      //블럭 페이지번호\r\n        blockPageCnt : 0,         //페이지 블럭 갯수\r\n        prevBlock : false,\r\n        nextBlock : false,        \r\n        loading : false\r\n      }\r\n    },\r\n    created() {\r\n\r\n    },\r\n    computed: {\r\n      // 알림톡 발송이력 조회\r\n      alarmTalkSndHistList() {                \r\n        return this.$store.state.trouble.alarmTalkSndHistList;            \r\n      },\r\n      userInfo() {\r\n      // 로그인 사용자 정보\r\n        return this.$store.state.auth.userInfo;\r\n      }\r\n    },\r\n    methods: {\r\n      getAlarmTalkSndHistList(pageNo){\r\n        \r\n        if(pageNo < this.blockPageNumber * this.blockPerPageSize){\r\n          this.getPrevBlock(pageNo);\r\n          return;\r\n        }\r\n        if(pageNo == (this.blockPageNumber+1) * this.blockPerPageSize){\r\n          this.getNextBlock(pageNo);\r\n          return;\r\n        }\r\n\r\n        //----------------------------------------------------------------\r\n        // Param Info\r\n        //----------------------------------------------------------------                \r\n        let custName = document.getElementById(\"custName\").value;   //고객명\r\n        let custTelNo = document.getElementById(\"custTelNo\").value;   //고객전화번호\r\n        let sndFromDt = document.getElementById(\"sndFromDt\").value;   //발송일시 From           \r\n        let sndToDt = document.getElementById(\"sndToDt\").value;   //발송일시 To                 \r\n        if(custTelNo.indexOf(\"0\") == 0){          \r\n          custTelNo = \"82\" + custTelNo.substr(1, custTelNo.length);\r\n        }\r\n        \r\n        // 유효성 체크\r\n        if(!this.isValidation()){\r\n          return;\r\n        }\r\n\r\n        let param = {\r\n          \"pageNo\" : pageNo,\r\n          \"recordSize\" : this.recordSize,        \r\n          \"sndCmpNo\" : this.userInfo.loginId,   //발송자 ID\r\n          \"custName\" : custName,\r\n          \"custTelNo\" : custTelNo,\r\n          \"sndFromDt\" : sndFromDt,\r\n          \"sndToDt\" : sndToDt\r\n        };        \r\n        this.loading = true;\r\n        this.$store.dispatch(\"trouble/alarmTalkSndHistList\", param).then(() => {                      \r\n          //----------------------------------------------------------------\r\n          // 페이징 처리        \r\n          //----------------------------------------------------------------\r\n          let listObj = this.alarmTalkSndHistList;          \r\n          this.pageNumber = listObj.pageable.pageNumber;  //페이지 번호\r\n          let totalPages = listObj.totalPages;    //총페이지 수\r\n          let totalCnt = listObj.totalElements; //총 건수\r\n          document.getElementById(\"totalCnt\").innerHTML = totalCnt.toLocaleString();\r\n          this.pagination(this.pageNumber, totalPages, totalCnt);\r\n          this.loading = false;\r\n        })\r\n        .catch(error => {\r\n          this.loading = false;\r\n          console.log(error);\r\n        });\r\n\r\n      }, \r\n      pagination(pageNumber, totalPages, totalCnt){\r\n        //--------------------------------------\r\n        // 페이지 네비게이션 처리\r\n        //--------------------------------------        \r\n        if(totalCnt == 0){\r\n            this.prevPage = false;      \r\n            this.nextPage = false;\r\n        } else {\r\n          if(pageNumber == 0){\r\n            this.prevPage = false;                  \r\n            if(totalPages == 1){\r\n              this.nextPage = false;\r\n            } else {\r\n              this.nextPage = true;\r\n            }\r\n          } else {\r\n            if(pageNumber == totalPages-1){          \r\n              this.prevPage = true;      \r\n              this.nextPage = false;\r\n            } else {\r\n              this.prevPage = true;     \r\n              this.nextPage = true;       \r\n            }\r\n          }\r\n        }\r\n        \r\n        //--------------------------------------\r\n        // 페이지의 페이지 네비게이션 처리\r\n        //--------------------------------------        \r\n        let blockPageCnt = 0;\r\n        let blockPerPageSize = this.blockPerPageSize;\r\n        if(totalPages % blockPerPageSize == 0){\r\n            blockPageCnt = totalPages / blockPerPageSize;\r\n        } else {\r\n          blockPageCnt = Math.floor((totalPages / blockPerPageSize)) + 1;\r\n        }                \r\n        this.blockPageCnt = blockPageCnt;            \r\n        \r\n        if(this.blockPageNumber == 0){\r\n          this.prevBlock = false;\r\n          if(this.blockPageCnt == 1){\r\n            this.nextBlock = false;\r\n          } else {\r\n            if((this.blockPageNumber+1) <= this.blockPageCnt){\r\n              this.nextBlock = true;\r\n            }\r\n          }          \r\n        } else {\r\n          this.prevBlock = true;          \r\n          if((this.blockPageNumber+1) == this.blockPageCnt){\r\n            this.nextBlock = false;\r\n          } else {\r\n            this.nextBlock = true;\r\n          }\r\n        }\r\n\r\n      },\r\n      getPrevBlock(pageNo){\r\n        this.blockPageNumber = this.blockPageNumber - 1;\r\n        let pageNumber = this.blockPageNumber * this.blockPerPageSize;\r\n        if(pageNo != null){\r\n          pageNumber = pageNo;\r\n        }      \r\n        this.getAlarmTalkSndHistList(pageNumber);\r\n      },\r\n      getNextBlock(pageNo){      \r\n        this.blockPageNumber = this.blockPageNumber + 1;      \r\n        let pageNumber = this.blockPageNumber * this.blockPerPageSize;\r\n        if(pageNo != null){\r\n          pageNumber = pageNo;\r\n        }      \r\n        this.getAlarmTalkSndHistList(pageNumber);\r\n      },\r\n      //발송일자 셋팅\r\n      setSndDt(){\r\n\r\n        var now = new Date();\r\n        var year = now.getFullYear();\r\n        var month = now.getMonth()+1;\r\n        var prevMonth = now.getMonth();\r\n        if(month <=9){\r\n          month = \"0\" + month;\r\n        }\r\n        if(prevMonth <=9){\r\n          prevMonth = \"0\" + prevMonth;\r\n        }\r\n        var day = now.getDate();        \r\n        if(day <=9){\r\n          day = \"0\" + day;\r\n        }      \r\n        \r\n        var today = year + \"-\" + month + \"-\" + day;  \r\n        var prevMonthLastDay = new Date(year, prevMonth, \"0\").getDate();        \r\n        if(day > prevMonthLastDay ){      //한달전 날짜가 해당월의 마지막 일자보다 큰경우\r\n          day = prevMonthLastDay;\r\n        }\r\n        var fromDay = year + \"-\" + prevMonth + \"-\" + day;           \r\n        document.getElementById(\"sndFromDt\").value = fromDay;\r\n        document.getElementById(\"sndToDt\").value = today;\r\n\r\n      },\r\n      // 발송기간 유효성 체크      \r\n      isValidation(){\r\n        let sndFromDt = document.getElementById(\"sndFromDt\").value;   //발송일시 From           \r\n        let sndToDt = document.getElementById(\"sndToDt\").value;       //발송일시 To   \r\n        if(sndFromDt == ''){\r\n          alert(\"발송기간을 선택 하세요\");\r\n          document.getElementById(\"sndFromDt\").focus();\r\n          return false;\r\n        }\r\n        if(sndToDt == ''){\r\n          alert(\"발송기간을 선택 하세요\");\r\n          document.getElementById(\"sndToDt\").focus();\r\n          return false;\r\n        }\r\n        if(new Date(sndToDt).getTime() - new Date(sndFromDt).getTime() < 0){\r\n          alert(\"이전날짜가 더 클 수 없습니다.\");\r\n          return false;\r\n        }\r\n        return true;\r\n      },\r\n      StringUtil(){\r\n        var obj = StringUtil;\r\n        return obj;        \r\n      }                 \r\n    },\r\n    \r\n    mounted(){\r\n      this.setSndDt();\r\n      this.getAlarmTalkSndHistList(0);\r\n    }\r\n  }\r\n</script>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}