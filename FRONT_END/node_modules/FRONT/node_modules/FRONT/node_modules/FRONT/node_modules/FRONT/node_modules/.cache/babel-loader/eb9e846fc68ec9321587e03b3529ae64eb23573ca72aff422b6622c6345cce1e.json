{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"C:/CSAI_Front/node_modules/@babel/runtime/helpers/interopRequireDefault.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _StringUtil = _interopRequireDefault(require(\"../../../utils/StringUtil\"));\nvar _LoadingArea = _interopRequireDefault(require(\"@/components/common/layer/LoadingArea\"));\n// 로딩 레이어\nvar _default = {\n  name: 'AlarmSendHistList',\n  emits: [\"openLayerPop\"],\n  components: {\n    LoadingArea: _LoadingArea.default\n  },\n  data() {\n    return {\n      //------------------------------------------------------------\n      // 페이지 처리 \n      //------------------------------------------------------------\n      pageNumber: 0,\n      //페이지 번호\n      recordSize: 10,\n      //한페이지당 보여질 리스트 갯수\n      prevPage: false,\n      nextPage: false,\n      //------------------------------------------------------------\n      // 페이지 블럭 처리 \n      //------------------------------------------------------------\n      blockPerPageSize: 10,\n      //블럭당 보여질 페이지 갯수\n      blockPageNumber: 0,\n      //블럭 페이지번호\n      blockPageCnt: 0,\n      //페이지 블럭 갯수\n      prevBlock: false,\n      nextBlock: false,\n      loading: false\n    };\n  },\n  created() {},\n  computed: {\n    // 알림톡 발송이력 조회\n    alarmTalkSndHistList() {\n      return this.$store.state.trouble.alarmTalkSndHistList;\n    },\n    userInfo() {\n      // 로그인 사용자 정보\n      return this.$store.state.auth.userInfo;\n    }\n  },\n  methods: {\n    getAlarmTalkSndHistList(pageNo) {\n      if (pageNo < this.blockPageNumber * this.blockPerPageSize) {\n        this.getPrevBlock(pageNo);\n        return;\n      }\n      if (pageNo == (this.blockPageNumber + 1) * this.blockPerPageSize) {\n        this.getNextBlock(pageNo);\n        return;\n      }\n\n      //----------------------------------------------------------------\n      // Param Info\n      //----------------------------------------------------------------                \n      let custName = document.getElementById(\"custName\").value; //고객명\n      let custTelNo = document.getElementById(\"custTelNo\").value; //고객전화번호\n      let sndFromDt = document.getElementById(\"sndFromDt\").value; //발송일시 From           \n      let sndToDt = document.getElementById(\"sndToDt\").value; //발송일시 To                 \n      if (custTelNo.indexOf(\"0\") == 0) {\n        custTelNo = \"82\" + custTelNo.substr(1, custTelNo.length);\n      }\n\n      // 유효성 체크\n      if (!this.isValidation()) {\n        return;\n      }\n      let param = {\n        \"pageNo\": pageNo,\n        \"recordSize\": this.recordSize,\n        \"sndCmpNo\": this.userInfo.loginId,\n        //발송자 ID\n        \"custName\": custName,\n        \"custTelNo\": custTelNo,\n        \"sndFromDt\": sndFromDt,\n        \"sndToDt\": sndToDt\n      };\n      this.loading = true;\n      this.$store.dispatch(\"trouble/alarmTalkSndHistList\", param).then(() => {\n        //----------------------------------------------------------------\n        // 페이징 처리        \n        //----------------------------------------------------------------\n        let listObj = this.alarmTalkSndHistList;\n        this.pageNumber = listObj.pageable.pageNumber; //페이지 번호\n        let totalPages = listObj.totalPages; //총페이지 수\n        let totalCnt = listObj.totalElements; //총 건수\n        document.getElementById(\"totalCnt\").innerHTML = totalCnt.toLocaleString();\n        this.pagination(this.pageNumber, totalPages, totalCnt);\n        this.loading = false;\n      }).catch(error => {\n        this.loading = false;\n        console.log(error);\n      });\n    },\n    pagination(pageNumber, totalPages, totalCnt) {\n      //--------------------------------------\n      // 페이지 네비게이션 처리\n      //--------------------------------------        \n      if (totalCnt == 0) {\n        this.prevPage = false;\n        this.nextPage = false;\n      } else {\n        if (pageNumber == 0) {\n          this.prevPage = false;\n          if (totalPages == 1) {\n            this.nextPage = false;\n          } else {\n            this.nextPage = true;\n          }\n        } else {\n          if (pageNumber == totalPages - 1) {\n            this.prevPage = true;\n            this.nextPage = false;\n          } else {\n            this.prevPage = true;\n            this.nextPage = true;\n          }\n        }\n      }\n\n      //--------------------------------------\n      // 페이지의 페이지 네비게이션 처리\n      //--------------------------------------        \n      let blockPageCnt = 0;\n      let blockPerPageSize = this.blockPerPageSize;\n      if (totalPages % blockPerPageSize == 0) {\n        blockPageCnt = totalPages / blockPerPageSize;\n      } else {\n        blockPageCnt = Math.floor(totalPages / blockPerPageSize) + 1;\n      }\n      this.blockPageCnt = blockPageCnt;\n      if (this.blockPageNumber == 0) {\n        this.prevBlock = false;\n        if (this.blockPageCnt == 1) {\n          this.nextBlock = false;\n        } else {\n          if (this.blockPageNumber + 1 <= this.blockPageCnt) {\n            this.nextBlock = true;\n          }\n        }\n      } else {\n        this.prevBlock = true;\n        if (this.blockPageNumber + 1 == this.blockPageCnt) {\n          this.nextBlock = false;\n        } else {\n          this.nextBlock = true;\n        }\n      }\n    },\n    getPrevBlock(pageNo) {\n      this.blockPageNumber = this.blockPageNumber - 1;\n      let pageNumber = this.blockPageNumber * this.blockPerPageSize;\n      if (pageNo != null) {\n        pageNumber = pageNo;\n      }\n      this.getAlarmTalkSndHistList(pageNumber);\n    },\n    getNextBlock(pageNo) {\n      this.blockPageNumber = this.blockPageNumber + 1;\n      let pageNumber = this.blockPageNumber * this.blockPerPageSize;\n      if (pageNo != null) {\n        pageNumber = pageNo;\n      }\n      this.getAlarmTalkSndHistList(pageNumber);\n    },\n    //발송일자 셋팅\n    setSndDt() {\n      var now = new Date();\n      var year = now.getFullYear();\n      var month = now.getMonth() + 1;\n      var prevMonth = now.getMonth();\n      if (month <= 9) {\n        month = \"0\" + month;\n      }\n      if (prevMonth <= 9) {\n        prevMonth = \"0\" + prevMonth;\n      }\n      var day = now.getDate();\n      if (day <= 9) {\n        day = \"0\" + day;\n      }\n      var today = year + \"-\" + month + \"-\" + day;\n      var prevMonthLastDay = new Date(year, prevMonth, \"0\").getDate();\n      if (day > prevMonthLastDay) {\n        //한달전 날짜가 해당월의 마지막 일자보다 큰경우\n        day = prevMonthLastDay;\n      }\n      var fromDay = year + \"-\" + prevMonth + \"-\" + day;\n      document.getElementById(\"sndFromDt\").value = fromDay;\n      document.getElementById(\"sndToDt\").value = today;\n    },\n    // 발송기간 유효성 체크      \n    isValidation() {\n      let sndFromDt = document.getElementById(\"sndFromDt\").value; //발송일시 From           \n      let sndToDt = document.getElementById(\"sndToDt\").value; //발송일시 To   \n      if (sndFromDt == '') {\n        alert(\"발송기간을 선택 하세요\");\n        document.getElementById(\"sndFromDt\").focus();\n        return false;\n      }\n      if (sndToDt == '') {\n        alert(\"발송기간을 선택 하세요\");\n        document.getElementById(\"sndToDt\").focus();\n        return false;\n      }\n      if (new Date(sndToDt).getTime() - new Date(sndFromDt).getTime() < 0) {\n        alert(\"이전날짜가 더 클 수 없습니다.\");\n        return false;\n      }\n      return true;\n    },\n    StringUtil() {\n      var obj = _StringUtil.default;\n      return obj;\n    }\n  },\n  mounted() {\n    this.setSndDt();\n    this.getAlarmTalkSndHistList(0);\n  }\n};\nexports.default = _default;","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}